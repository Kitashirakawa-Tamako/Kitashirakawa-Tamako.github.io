(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[447],{3322:function(t,o,e){"use strict";let n,l,u,r,a;var i=e(5893),d=e(7294),s=e(7520),c=e(4054);let T=new ArrayBuffer(245760),b=new Uint8ClampedArray(T),v=new Uint32Array(T),_=0,f=0,N=new Float32Array(1024),h=new Float32Array(1024),p=new s.NES({onFrame:t=>{for(let o=0;o<v.length;o++)v[o]=4278190080|t[o]},onAudioSample:(t,o)=>{N[f]=t,h[f]=o,f=f+1&1023}}),E=(0,d.forwardRef)(function(t,o){var s,T,v,f,E,U,B,O,w,g,m,x,S,j,D,R,L,C,G,k,A,y,P,M,V,F,H,I,W,K,z,J,X,Z;let q=()=>p.toJSON(),Y=t=>{tl(t.romData),p.fromJSON(t)},Q=()=>{var o;clearInterval(l),n.fillStyle=null!==(o=t.fillStyle)&&void 0!==o?o:"#000",n.fillRect(0,0,256,240),null!=a&&a.disconnect(),null!=r&&r.disconnect(),p.reset()},$=t=>{tl(t)};(0,d.useImperativeHandle)(o,()=>({buttonDown:p.buttonDown,buttonUp:p.buttonUp,saveData:q,loadData:Y,reset:Q,loadRom:$}));let tt={a1:{controller:c.z.P1,button:c.E.BUTTON_A,code:null!==(L=null===(s=t.buttons)||void 0===s?void 0:s.a1)&&void 0!==L?L:"KeyJ"},b1:{controller:c.z.P1,button:c.E.BUTTON_B,code:null!==(C=null===(T=t.buttons)||void 0===T?void 0:T.b1)&&void 0!==C?C:"KeyK"},select1:{controller:c.z.P1,button:c.E.BUTTON_SELECT,code:null!==(G=null===(v=t.buttons)||void 0===v?void 0:v.select1)&&void 0!==G?G:"KeyF"},start1:{controller:c.z.P1,button:c.E.BUTTON_START,code:null!==(k=null===(f=t.buttons)||void 0===f?void 0:f.start1)&&void 0!==k?k:"KeyH"},up1:{controller:c.z.P1,button:c.E.BUTTON_UP,code:null!==(A=null===(E=t.buttons)||void 0===E?void 0:E.up1)&&void 0!==A?A:"KeyW"},down1:{controller:c.z.P1,button:c.E.BUTTON_DOWN,code:null!==(y=null===(U=t.buttons)||void 0===U?void 0:U.down1)&&void 0!==y?y:"KeyS"},left1:{controller:c.z.P1,button:c.E.BUTTON_LEFT,code:null!==(P=null===(B=t.buttons)||void 0===B?void 0:B.left1)&&void 0!==P?P:"KeyA"},right1:{controller:c.z.P1,button:c.E.BUTTON_RIGHT,code:null!==(M=null===(O=t.buttons)||void 0===O?void 0:O.right1)&&void 0!==M?M:"KeyD"},a2:{controller:2,button:c.E.BUTTON_A,code:null!==(V=null===(w=t.buttons)||void 0===w?void 0:w.a2)&&void 0!==V?V:"Numpad1"},b2:{controller:2,button:c.E.BUTTON_B,code:null!==(F=null===(g=t.buttons)||void 0===g?void 0:g.b2)&&void 0!==F?F:"Numpad2"},select2:{controller:2,button:c.E.BUTTON_SELECT,code:null!==(H=null===(m=t.buttons)||void 0===m?void 0:m.select2)&&void 0!==H?H:"Numpad4"},start2:{controller:2,button:c.E.BUTTON_START,code:null!==(I=null===(x=t.buttons)||void 0===x?void 0:x.start2)&&void 0!==I?I:"Numpad5"},up2:{controller:2,button:c.E.BUTTON_UP,code:null!==(W=null===(S=t.buttons)||void 0===S?void 0:S.up2)&&void 0!==W?W:"ArrowUp"},down2:{controller:2,button:c.E.BUTTON_DOWN,code:null!==(K=null===(j=t.buttons)||void 0===j?void 0:j.down2)&&void 0!==K?K:"ArrowDown"},left2:{controller:2,button:c.E.BUTTON_LEFT,code:null!==(z=null===(D=t.buttons)||void 0===D?void 0:D.left2)&&void 0!==z?z:"ArrowLeft"},right2:{controller:2,button:c.E.BUTTON_RIGHT,code:null!==(J=null===(R=t.buttons)||void 0===R?void 0:R.right2)&&void 0!==J?J:"ArrowRight"}},to=[];for(let t of Object.keys(tt))to.push(tt[t]);let te=(0,d.useRef)(null),tn=()=>{let t=new ImageData(b,256,240);n.putImageData(t,0,0),p.frame()},tl=o=>{var e;Q(),p.loadROM(o),null==u&&(u=new window.AudioContext),null==a&&(a=u.createGain()),null==r&&((r=u.createScriptProcessor(1024)).onaudioprocess=t=>{let o=t.outputBuffer,e=o.getChannelData(0),n=o.getChannelData(1);for(let t=0;t<o.length;t++)e[t]=N[_],n[t]=h[_],_=_+1&1023}),a.gain.value=null!==(e=t.volume)&&void 0!==e?e:.5,a.connect(u.destination),r.connect(a),l=setInterval(tn,16.7)};return(0,d.useEffect)(()=>{if(null!=te.current){let t=te.current.getContext("2d",{willReadFrequently:!0});null!=t&&(n=t,Q())}e(4936);let o=window.gameControl;o.on("connect",function(o){var e;null===(e=t.onGamepadConnect)||void 0===e||e.call(t,o);let n=o.id+1;o.before("button0",()=>{p.buttonDown(n,c.E.BUTTON_A)}).after("button0",()=>{p.buttonUp(n,c.E.BUTTON_A)}).before("button1",()=>{p.buttonDown(n,c.E.BUTTON_B)}).after("button1",()=>{p.buttonUp(n,c.E.BUTTON_B)}).before("select",()=>{p.buttonDown(n,c.E.BUTTON_SELECT)}).after("select",()=>{p.buttonUp(n,c.E.BUTTON_SELECT)}).before("start",()=>{p.buttonDown(n,c.E.BUTTON_START)}).after("start",()=>{p.buttonUp(n,c.E.BUTTON_START)}).before("up",()=>{p.buttonDown(n,c.E.BUTTON_UP)}).after("up",()=>{p.buttonUp(n,c.E.BUTTON_UP)}).before("down",()=>{p.buttonDown(n,c.E.BUTTON_DOWN)}).after("down",()=>{p.buttonUp(n,c.E.BUTTON_DOWN)}).before("left",()=>{p.buttonDown(n,c.E.BUTTON_LEFT)}).after("left",()=>{p.buttonUp(n,c.E.BUTTON_LEFT)}).before("right",()=>{p.buttonDown(n,c.E.BUTTON_RIGHT)}).after("right",()=>{p.buttonUp(n,c.E.BUTTON_RIGHT)}).before("button12",()=>{p.buttonDown(n,c.E.BUTTON_UP)}).after("button12",()=>{p.buttonUp(n,c.E.BUTTON_UP)}).before("button13",()=>{p.buttonDown(n,c.E.BUTTON_DOWN)}).after("button13",()=>{p.buttonUp(n,c.E.BUTTON_DOWN)}).before("button14",()=>{p.buttonDown(n,c.E.BUTTON_LEFT)}).after("button14",()=>{p.buttonUp(n,c.E.BUTTON_LEFT)}).before("button15",()=>{p.buttonDown(n,c.E.BUTTON_RIGHT)}).after("button15",()=>{p.buttonUp(n,c.E.BUTTON_RIGHT)})}),o.on("disconnect",function(o){var e;null===(e=t.onGamepadDisconnect)||void 0===e||e.call(t,o)})},[]),(0,d.useEffect)(()=>{if(null!=a){var o;a.gain.value=null!==(o=t.volume)&&void 0!==o?o:.5}},[t.volume]),(0,d.useEffect)(()=>{if(!0===t.fullScreen){var o;null===(o=te.current)||void 0===o||o.requestFullscreen().catch(()=>{})}},[t.fullScreen]),(0,d.useEffect)(()=>{document.onkeydown=o=>{for(let n=0;n<to.length;n++)if(to[n].code===o.code){var e;p.buttonDown(to[n].controller,to[n].button),null===(e=t.onButtonEvent)||void 0===e||e.call(t,{type:"keydown",...to[n]})}},document.onkeyup=o=>{for(let n=0;n<to.length;n++)if(to[n].code===o.code){var e;p.buttonUp(to[n].controller,to[n].button),null===(e=t.onButtonEvent)||void 0===e||e.call(t,{type:"keyup",...to[n]})}}},[t.buttons]),(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("div",{children:(0,i.jsx)("canvas",{ref:te,style:{width:null!==(X=t.width)&&void 0!==X?X:256,height:null!==(Z=t.height)&&void 0!==Z?Z:240},width:256,height:240})})})});o.Z=E},4054:function(t,o,e){"use strict";var n,l,u,r;e.d(o,{E:function(){return n},z:function(){return l}}),(u=n||(n={}))[u.BUTTON_A=0]="BUTTON_A",u[u.BUTTON_B=1]="BUTTON_B",u[u.BUTTON_SELECT=2]="BUTTON_SELECT",u[u.BUTTON_START=3]="BUTTON_START",u[u.BUTTON_UP=4]="BUTTON_UP",u[u.BUTTON_DOWN=5]="BUTTON_DOWN",u[u.BUTTON_LEFT=6]="BUTTON_LEFT",u[u.BUTTON_RIGHT=7]="BUTTON_RIGHT",(r=l||(l={}))[r.P1=1]="P1",r[r.P2=2]="P2"},7447:function(t,o,e){"use strict";e.r(o),e.d(o,{default:function(){return s}});var n=e(5893),l=e(7294),u=e(4054),r=e(3322),a=e(6314),i=e.n(a),d=function(t){let o=(0,l.useRef)(null),[e,r]=(0,l.useState)("none"),[a,d]=(0,l.useState)(1),s=t=>{"up"===t&&(r("rotateX(15deg)"),T(u.E.BUTTON_UP)),"down"===t&&(r("rotateX(-15deg)"),T(u.E.BUTTON_DOWN)),"left"===t&&(r("rotateY(-15deg)"),T(u.E.BUTTON_LEFT)),"right"===t&&(r("rotateY(15deg)"),T(u.E.BUTTON_RIGHT))},c=t=>{"up"===t&&b(u.E.BUTTON_UP),"down"===t&&b(u.E.BUTTON_DOWN),"left"===t&&b(u.E.BUTTON_LEFT),"right"===t&&b(u.E.BUTTON_RIGHT),r("none")},T=o=>{var e;null===(e=t.nesRef.current)||void 0===e||e.buttonDown(u.z.P1,o)},b=o=>{var e;null===(e=t.nesRef.current)||void 0===e||e.buttonUp(u.z.P1,o)};return(0,l.useEffect)(()=>{null!=o.current&&d(o.current.parentNode.offsetWidth/o.current.offsetWidth)},[]),(0,n.jsx)("div",{style:{width:"100%",height:180*a},onTouchMove:t=>{t.stopPropagation(),t.preventDefault()},children:(0,n.jsx)("div",{className:i().gamepad,ref:o,style:{transform:"scale(".concat(a,")"),transformOrigin:"0 0"},children:(0,n.jsx)("div",{className:i().main,children:(0,n.jsxs)("div",{className:i().panel,children:[(0,n.jsx)("div",{className:i().bg1}),(0,n.jsx)("div",{className:i().bg2}),(0,n.jsx)("div",{className:i().bg3}),(0,n.jsx)("div",{className:i().bg4}),(0,n.jsxs)("div",{className:i()["direction-pad"],style:{transform:e},children:[(0,n.jsx)("div",{className:i().bg}),(0,n.jsx)("div",{className:i()["button-up"],onMouseDown:()=>{s("up")},onMouseUp:()=>{c("up")},onTouchStart:()=>{s("up")},onTouchEnd:()=>{c("up")},children:(0,n.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.2692 6.98965C23.0395 5.65908 24.9605 5.65908 25.7309 6.98965L44.262 38.9979C45.0339 40.3313 44.0718 42 42.5311 42H5.4689C3.92823 42 2.96611 40.3313 3.73804 38.9979L22.2692 6.98965Z",fill:"#333",stroke:"#000",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsx)("div",{className:i()["button-down"],onMouseDown:()=>{s("down")},onMouseUp:()=>{c("down")},onTouchStart:()=>{s("down")},onTouchEnd:()=>{s("down")},children:(0,n.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.2692 6.98965C23.0395 5.65908 24.9605 5.65908 25.7309 6.98965L44.262 38.9979C45.0339 40.3313 44.0718 42 42.5311 42H5.4689C3.92823 42 2.96611 40.3313 3.73804 38.9979L22.2692 6.98965Z",fill:"#333",stroke:"#000",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsx)("div",{className:i()["button-left"],onMouseDown:()=>{s("left")},onMouseUp:()=>{c("left")},onTouchStart:()=>{s("left")},onTouchEnd:()=>{c("left")},children:(0,n.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.2692 6.98965C23.0395 5.65908 24.9605 5.65908 25.7309 6.98965L44.262 38.9979C45.0339 40.3313 44.0718 42 42.5311 42H5.4689C3.92823 42 2.96611 40.3313 3.73804 38.9979L22.2692 6.98965Z",fill:"#333",stroke:"#000",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,n.jsx)("div",{className:i()["button-right"],onMouseDown:()=>{s("right")},onMouseUp:()=>{c("right")},onTouchStart:()=>{s("right")},onTouchEnd:()=>{c("right")},children:(0,n.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22.2692 6.98965C23.0395 5.65908 24.9605 5.65908 25.7309 6.98965L44.262 38.9979C45.0339 40.3313 44.0718 42 42.5311 42H5.4689C3.92823 42 2.96611 40.3313 3.73804 38.9979L22.2692 6.98965Z",fill:"#333",stroke:"#000",strokeWidth:"4",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),(0,n.jsxs)("div",{className:i()["function-pad"],children:[(0,n.jsx)("div",{className:i()["button-select"],onMouseDown:()=>{T(u.E.BUTTON_SELECT)},onMouseUp:()=>{b(u.E.BUTTON_SELECT)},onTouchStart:()=>{T(u.E.BUTTON_SELECT)},onTouchEnd:()=>{b(u.E.BUTTON_SELECT)}}),(0,n.jsx)("div",{className:i()["button-start"],onMouseDown:()=>{T(u.E.BUTTON_START)},onMouseUp:()=>{b(u.E.BUTTON_START)},onTouchStart:()=>{T(u.E.BUTTON_START)},onTouchEnd:()=>{b(u.E.BUTTON_START)}})]}),(0,n.jsxs)("div",{className:i()["action-pad"],children:[(0,n.jsx)("div",{className:i()["button-b"],onMouseDown:()=>{T(u.E.BUTTON_B)},onMouseUp:()=>{b(u.E.BUTTON_B)},onTouchStart:()=>{T(u.E.BUTTON_B)},onTouchEnd:()=>{b(u.E.BUTTON_B)}}),(0,n.jsx)("div",{className:i()["button-a"],onMouseDown:()=>{T(u.E.BUTTON_A)},onMouseUp:()=>{b(u.E.BUTTON_A)},onTouchStart:()=>{T(u.E.BUTTON_A)},onTouchEnd:()=>{b(u.E.BUTTON_A)}})]})]})})})})};function s(){let[t,o]=(0,l.useState)(1),[e,u]=(0,l.useState)(!1),a=(0,l.useRef)(null),[i,s]=(0,l.useState)({a1:"KeyJ",b1:"KeyK"});return(0,n.jsxs)("div",{className:"demo",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("button",{onClick:()=>{fetch("/超级玛丽.nes").then(t=>{if(!t.ok)throw Error("HTTP error! Status: ".concat(t.status));return t}).then(async t=>await t.blob()).then(t=>{let o=new FileReader;o.readAsBinaryString(t),o.onload=t=>{var e;null===(e=a.current)||void 0===e||e.loadRom(o.result)}}).catch(t=>{console.error("Error occurred while fetching the blob object:",t)})},children:"Load Super Mario Bros"}),(0,n.jsxs)("button",{onClick:e=>{0===t?o(1):o(0)},children:["Volume ",t]}),(0,n.jsx)("button",{onClick:()=>{u(!e)},children:"Full screen"}),(0,n.jsx)("button",{onClick:()=>{var t;let o=JSON.stringify(null===(t=a.current)||void 0===t?void 0:t.saveData());localStorage.setItem("test",o)},children:"Save data"}),(0,n.jsx)("button",{onClick:()=>{var t;let o=localStorage.getItem("test");if(null==o){console.log("nothing to load");return}let e=JSON.parse(o);null===(t=a.current)||void 0===t||t.loadData(e)},children:"Load data"}),(0,n.jsx)("button",{onClick:()=>{var t;null===(t=a.current)||void 0===t||t.reset()},children:"Reset"})]}),(0,n.jsxs)("div",{children:["buttons setting: a1",(0,n.jsx)("input",{defaultValue:i.a1,onBlur:t=>{s({...i,a1:t.target.value})}}),"b1",(0,n.jsx)("input",{defaultValue:i.b1,onBlur:t=>{s({...i,b1:t.target.value})}})]}),(0,n.jsx)(r.Z,{onGamepadConnect:t=>{console.log(t)},onGamepadDisconnect:t=>{console.log(t)},onButtonEvent:t=>{console.log(t)},ref:a,buttons:i,volume:t,fullScreen:e,width:512,height:480}),(0,n.jsx)("div",{style:{marginTop:10,width:400},children:(0,n.jsx)(d,{nesRef:a})})]})}},6314:function(t){t.exports={gamepad:"VirtualGamepad_gamepad__XEKHB",main:"VirtualGamepad_main__mxNvl",panel:"VirtualGamepad_panel__N_f6q",bg1:"VirtualGamepad_bg1__xeQR_",bg2:"VirtualGamepad_bg2__Hi1KF",bg3:"VirtualGamepad_bg3__NcEKb",bg4:"VirtualGamepad_bg4__8BDAm","direction-pad":"VirtualGamepad_direction-pad__UYXpX",bg:"VirtualGamepad_bg___ELNv","button-up":"VirtualGamepad_button-up__kO08_","button-down":"VirtualGamepad_button-down__iLk83","button-left":"VirtualGamepad_button-left__v1nNI","button-right":"VirtualGamepad_button-right__SxacP","function-pad":"VirtualGamepad_function-pad__zDkNh","button-select":"VirtualGamepad_button-select__HBVa8","button-start":"VirtualGamepad_button-start__eFmXK","action-pad":"VirtualGamepad_action-pad__905tI","button-b":"VirtualGamepad_button-b__v7tFh","button-a":"VirtualGamepad_button-a__aGtGv"}}}]);